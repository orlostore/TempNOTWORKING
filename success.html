<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmed - ORLO Store</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Almarai:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .arabic-text { font-family: 'Almarai', sans-serif; direction: rtl; }

        .page-container {
            width: 100%;
            max-width: 740px;
            background: white;
            border-radius: 14px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* LEFT PANEL */
        .left-panel {
            width: 250px;
            flex-shrink: 0;
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 35px 20px;
            position: relative;
            overflow: hidden;
        }

        .left-panel::before {
            content: '';
            position: absolute;
            top: -40%;
            right: -40%;
            width: 80%;
            height: 80%;
            background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);
            pointer-events: none;
        }

        .checkmark-circle {
            width: 65px; height: 65px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 14px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            animation: scaleIn 0.4s ease-out 0.2s both;
            position: relative;
            z-index: 1;
        }
        @keyframes scaleIn { from { transform: scale(0); } to { transform: scale(1); } }

        .checkmark { width: 32px; height: 32px; stroke: #28a745; stroke-width: 3; fill: none; animation: drawCheck 0.5s ease-out 0.5s both; }
        @keyframes drawCheck { from { stroke-dashoffset: 100; } to { stroke-dashoffset: 0; } }

        .left-panel h2 {
            color: white; font-size: 1.15rem; font-weight: 700;
            text-align: center; margin-bottom: 3px; position: relative; z-index: 1;
        }

        .left-panel .ar-title {
            color: rgba(255,255,255,0.85); font-family: 'Almarai', sans-serif;
            font-size: 0.9rem; text-align: center; margin-bottom: 18px;
            position: relative; z-index: 1;
        }

        /* Vertical timeline */
        .timeline-vertical {
            display: flex; flex-direction: column; gap: 0;
            position: relative; z-index: 1; width: 100%; padding: 0 12px;
        }

        .tl-step {
            display: flex; align-items: center; gap: 8px;
            padding: 6px 0; position: relative;
        }

        .tl-step:not(:last-child)::after {
            content: ''; position: absolute; left: 12px; top: 30px;
            width: 2px; height: calc(100% - 14px);
            background: rgba(255,255,255,0.25);
        }

        .tl-step.active:not(:last-child)::after { background: rgba(255,255,255,0.5); }

        .tl-dot {
            width: 26px; height: 26px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.65rem; flex-shrink: 0;
            background: rgba(255,255,255,0.2); color: rgba(255,255,255,0.5);
        }

        .tl-step.active .tl-dot { background: white; color: #28a745; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }

        .tl-text { font-size: 0.7rem; color: rgba(255,255,255,0.5); line-height: 1.3; }
        .tl-step.active .tl-text { color: white; font-weight: 600; }
        .tl-text .ar { font-family: 'Almarai', sans-serif; font-size: 0.6rem; opacity: 0.8; display: block; }

        /* RIGHT PANEL */
        .right-panel {
            flex: 1;
            padding: 24px 26px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .info-card {
            background: #f8f9fa; border-radius: 10px; padding: 12px 14px;
            margin-bottom: 10px; border-left: 3px solid #e07856;
        }

        .info-card h3 { color: #2c4a5c; font-size: 0.82rem; margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }
        .info-card p { color: #666; font-size: 0.78rem; line-height: 1.5; }
        .info-card .arabic-text { text-align: right; margin-top: 2px; color: #999; font-size: 0.7rem; }

        /* BUTTONS */
        .btn-stack { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }

        .btn-row { display: flex; gap: 8px; }

        .btn {
            flex: 1; padding: 11px; border-radius: 10px; text-align: center;
            font-size: 0.82rem; font-weight: 600; text-decoration: none; color: white;
            cursor: pointer; border: none; font-family: 'Inter', sans-serif; transition: all 0.2s;
        }
        .btn .ar { display: block; font-size: 0.65rem; opacity: 0.85; font-family: 'Almarai', sans-serif; margin-top: 1px; }

        .btn-blue { background: linear-gradient(135deg, #2c4a5c, #1e3545); }
        .btn-blue:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(44,74,92,0.3); }

        .btn-orange { background: linear-gradient(135deg, #e07856, #c96644); }
        .btn-orange:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(224,120,86,0.3); }

        .btn-green {
            background: linear-gradient(135deg, #1e7a4a, #2c6e5a);
            padding: 9px 14px; font-size: 0.78rem;
        }
        .btn-green:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(30,122,74,0.3); }
        .btn-green .ar { font-size: 0.65rem; }

        .footer-note { text-align: center; margin-top: 12px; padding-top: 10px; border-top: 1px solid #eee; color: #bbb; font-size: 0.7rem; }
        .footer-note a { color: #e07856; text-decoration: none; }

        .account-msg {
            text-align: center; margin-top: 10px; padding: 12px;
            border-radius: 10px; font-size: 0.78rem; line-height: 1.5;
            display: none;
        }
        .account-msg.success {
            display: block; background: #f0faf4; border: 1px solid #1e7a4a; color: #1e7a4a;
        }
        .account-msg.error {
            display: block; background: #f8d7da; border: 1px solid #dc3545; color: #721c24;
        }
        .account-msg .arabic-text { font-size: 0.72rem; color: inherit; opacity: 0.85; margin-top: 4px; }
        .account-msg a { color: #e07856; font-weight: 600; }

        /* MOBILE */
        @media (max-width: 768px) {
            body { padding: 15px; }

            .page-container {
                flex-direction: column;
                max-width: 420px;
            }

            .left-panel {
                width: 100%; padding: 22px 20px; flex-shrink: initial;
            }

            .checkmark-circle { width: 50px; height: 50px; margin-bottom: 10px; }
            .checkmark { width: 25px; height: 25px; }
            .left-panel h2 { font-size: 1.05rem; }
            .left-panel .ar-title { font-size: 0.85rem; margin-bottom: 12px; }

            .timeline-vertical { flex-direction: row; justify-content: space-between; padding: 0; }
            .tl-step { flex-direction: column; text-align: center; gap: 3px; padding: 0; }
            .tl-step:not(:last-child)::after { display: none; }
            .tl-dot { width: 24px; height: 24px; font-size: 0.6rem; }
            .tl-text { font-size: 0.6rem; }
            .tl-text .ar { font-size: 0.5rem; }

            .right-panel { padding: 16px 18px; }
            .btn-row { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="left-panel">
            <div class="checkmark-circle">
                <svg class="checkmark" viewBox="0 0 52 52" stroke-dasharray="100" stroke-dashoffset="100">
                    <path fill="none" d="M14 27l7 7 16-16"/>
                </svg>
            </div>
            <h2>Order Confirmed!</h2>
            <p class="ar-title">ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­</p>

            <div class="timeline-vertical">
                <div class="tl-step active">
                    <div class="tl-dot">âœ“</div>
                    <div class="tl-text">Confirmed<span class="ar">ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯</span></div>
                </div>
                <div class="tl-step">
                    <div class="tl-dot">ğŸ“¦</div>
                    <div class="tl-text">Processing<span class="ar">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</span></div>
                </div>
                <div class="tl-step">
                    <div class="tl-dot">ğŸšš</div>
                    <div class="tl-text">Shipped<span class="ar">ØªÙ… Ø§Ù„Ø´Ø­Ù†</span></div>
                </div>
                <div class="tl-step">
                    <div class="tl-dot">âœ¨</div>
                    <div class="tl-text">Delivered<span class="ar">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span></div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="info-card">
                <h3>ğŸ“¦ What's Next?</h3>
                <p>We're preparing your order! You'll get tracking info once it ships.</p>
                <p class="arabic-text">Ù†Ø­Ù† Ù†Ø¬Ù‡Ø² Ø·Ù„Ø¨Ùƒ! Ø³ØªØªÙ„Ù‚Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ Ø¹Ù†Ø¯ Ø§Ù„Ø´Ø­Ù†.</p>
            </div>

            <div class="info-card">
                <h3>â±ï¸ Estimated Delivery</h3>
                <p><strong>2-5 business days</strong> across UAE</p>
                <p class="arabic-text"><strong>Ù¢-Ù¥ Ø£ÙŠØ§Ù… Ø¹Ù…Ù„</strong> ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</p>
            </div>

            <div class="btn-stack">
                <div class="btn-row">
                    <a href="/" class="btn btn-blue" onclick="localStorage.removeItem('cart')">
                        ğŸ›ï¸ Continue Shopping<span class="ar">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚</span>
                    </a>
                    <a href="mailto:info@orlostore.com" class="btn btn-orange">
                        âœ‰ï¸ Need Help?<span class="ar">ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŸ</span>
                    </a>
                </div>
                <!-- Guest only: Create Account button -->
                <button class="btn btn-green" id="registerBtn" style="display:none" onclick="oneClickAccount()">
                    ğŸ” Create Hassle-Free Account in One Click<span class="ar">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ù†Ø§Ø¡ Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</span>
                </button>
            </div>

            <div class="account-msg" id="accountMsg"></div>

            <div class="footer-note">
                Questions? <a href="mailto:info@orlostore.com">info@orlostore.com</a>
            </div>
        </div>
    </div>

    <script>
        localStorage.removeItem('cart');

        const existingToken = localStorage.getItem('orlo_token') || sessionStorage.getItem('orlo_token');
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');

        if (existingToken) {
            // Logged in user - hide register button
            document.getElementById('registerBtn').style.display = 'none';
        } else if (sessionId) {
            // Guest - check if email already has an account before showing button
            (async function() {
                try {
                    const res = await fetch('/api/auth/check-session-email', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ session_id: sessionId })
                    });
                    const data = await res.json();
                    if (data.registered) {
                        // Already has account - show login prompt instead
                        document.getElementById('registerBtn').style.display = 'none';
                        const msg = document.getElementById('accountMsg');
                        msg.className = 'account-msg success';
                        msg.innerHTML = 'You already have an account! <a href="login.html">Login to track your order</a><p class="arabic-text">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„! <a href="login.html">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ùƒ</a></p>';
                    } else {
                        document.getElementById('registerBtn').style.display = 'block';
                    }
                } catch (e) {
                    // If check fails, show button anyway (fallback to current behavior)
                    document.getElementById('registerBtn').style.display = 'block';
                }
            })();
        }

        async function oneClickAccount() {
            const btn = document.getElementById('registerBtn');
            const msg = document.getElementById('accountMsg');

            btn.disabled = true;
            btn.innerHTML = 'Creating...<span class="ar">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...</span>';

            try {
                const response = await fetch('/api/auth/guest-to-account', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ session_id: sessionId })
                });

                const data = await response.json();

                if (data.success) {
                    localStorage.setItem('orlo_token', data.token);
                    localStorage.setItem('orlo_customer', JSON.stringify(data.customer));

                    btn.style.display = 'none';
                    msg.className = 'account-msg success';
                    msg.innerHTML = "You're all set! We've sent your login details to your email. Don't forget to change your password and verify your account when you get a chance.<br><a href=\"account.html\">Go to your account</a><p class=\"arabic-text\">Ø£Ø±Ø³Ù„Ù†Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ. Ù„Ø§ ØªÙ†Ø³Ù ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ.</p>";
                } else {
                    if (data.error && data.error.includes('already registered')) {
                        btn.style.display = 'none';
                        msg.className = 'account-msg error';
                        msg.innerHTML = 'This email already has an account. <a href="login.html">Login instead</a>';
                    } else {
                        msg.className = 'account-msg error';
                        msg.innerHTML = data.error || 'Something went wrong. Please try again.';
                        btn.disabled = false;
                        btn.innerHTML = 'ğŸ” Create Hassle-Free Account in One Click<span class="ar">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ù†Ø§Ø¡ Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</span>';
                    }
                }
            } catch (error) {
                msg.className = 'account-msg error';
                msg.innerHTML = 'Connection error. Please try again.';
                btn.disabled = false;
                btn.innerHTML = 'ğŸ” Create Hassle-Free Account in One Click<span class="ar">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ù†Ø§Ø¡ Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</span>';
            }
        }
    </script>
</body>
</html>
